# USAGE
``` sh
cd bin/server
./dnsd   # DNS service
./httpd  # HTTP service
```

## environment vars
**ADDR** is the address DNS server returns for names in the blocklist - useful to send traffic to a proxy for rewrites/substitutions. send all traffic to a proxy with **http_proxy** set at the client or server (for chained-proxy topologies). go without env vars or system resolver/proxy settings by using a split routing scheme for HTTP and DNS, see [proxy_routes](bin/proxy_routes). this is the recommended approach for untrusted apps which may ignore system proxy and DNS preferences. this requires uid separation between apps and proxy, which Android has in its app-sandbox uids. traditional distros may already have a proxy user configured if you've installed Squid, Varnish, etc. when **OFFLINE** is set, requests are serviced from local cache. for verbose logs launch the server with: **CONSOLE_LEVEL**=debug httpd

## auth hoop-jumping
[bookmarklet](config/bookmarks/UI.u) jumps context from upstream to proxy with upstream cookies. this is just just enough to quell Twitter/Imperva/Incapsula errors without involving HTTPS MITM or browser plugins. Cloudflare and FB often soon revert to blocking requests. it's a huge cat&mouse game to get all potential fingerprinting sources matching a 'full fat' client with different SSL/TLS library/ciphersuites and HTTPS versions, cloned headers slightly tweaked by Rack's header-to-CGI-var munging, cache invalidations from 'Vary' headers or resource-integrity hashes, short token-expiry, HTTP-only flags on cookie visibility etc that i'm too lazy to try to make that stuff readable as it's mostly a lot of autogenerated blogspam and there's ctrl-W for when these cloud-middleware overlords are too much an adversary to basic low-traffic read-only access to the web.

## customization
edit site behaviors in [site.rb](config/scripts/site.rb). ideally none are necessary as the goal is to eliminate special handling. to eliminate a lot of per-request filestat calls, most [config](config/) updates require a process restart or a reload with ctrl-shift-R to send a no-cache header to invalidate the config cache

## peers
each of your devices can probably host their own d√¶mon - with the default [falcon](https://github.com/socketry/falcon) backend you no longer have to blow away scarce RAM on mobile/SBC devices with an archaic preforking model. peer servers improve cache availability during network segmentation and reduce pipe-utilization when online. define peer servers in the HOSTS file, and listen on HTTP ports on a private net provided via [Nebula](https://www.defined.net/)/[Tailscale](https://tailscale.com/)/[Zerotier](https://www.zerotier.com/), or use HTTPS on the public net. see [this](bin/certificate) for certificate minting