Jul 20 16:22:11 2023 -> Sep 10 01:07:53 2023 (ad57a727491c5b28f8ed5bff1bd25c71bb61214a -> adb0306d790901d5b38f9d6966b1de39a3c378f7)

- make env optional and improve text output on [tabular](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/CSV.rb#L6) renderer
- make env optional on [URI](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/HTML.rb#L560) renderer
- [declarative host categories](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/Config.rb#L37) - add forward and UI rehost categories ( extant URL rehost YT rehost categories)
- add [#relocate](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/URI.rb#L125) method
- use relocate method on [HREF](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/HTML.rb#L91) during format to prevent 301 redirects
- [declarative feed names](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/Feed.rb#L5) for when @rel isn't defined
- simplify [RSS reader](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/Feed.rb#L52)
- add [StripTags](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/HTML.rb#L19) constant, use in more places HTML input happens so \<noscript\> doesnt hide content we want to see
- add [#cachestamp](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/HTML.rb#L21) method to store base URI inline in HTML header for offline/cache resolution
- stop keyboard navigation into upstream-provided input boxes by [stripping](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/HTML.rb#L76) IDs and autofocus attrs
- generate toolbar [UI rehost](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Formats/HTML.rb#L291) links
- remove the last site-specific HTML triplr, by merging [google-searchresult](https://gitlab.com/ix/webize/-/blob/d9927c3251772ff66399fb2927bd4a7c605a5142/config/scripts/site.rb#L44) CSS hints into the subpost matcher
- remove explicit image RDF emission when also emitted in embedded HTML from HTML/feed/mardown triplrs as an alternative to runtime deduplication in the renderer. eventually we might want to turn this behaviour back on but only for summary/preview generation if we ever get around to wanting that enough (Rather than surgically requesting the exact full resources we want all the time, so like casual archive/disk browsing or index generation)
- remove [input form normalization guards](https://gitlab.com/ix/webize/-/blob/d9927c3251772ff66399fb2927bd4a7c605a5142/Formats/Image.rb#L60) for the Image and Video renderers since we're no longer running them with arbitrary unprocessed JSON now that we have better blank node support and inlining capabilities at the graph->tree conversion stage
- add activitystream parser subclassed from JSON-LD for new [nostr/fediverse-bridge](http://mw.logbook.am/image/mostr.png) use cases
- split [#fileMIME](https://gitlab.com/ix/webize/-/blob/main/Formats/MIME.rb#L20) into pure and impure versions and use the pure version when we don't need symlink following, dangling symlink existence checks and misc fs failure handling fun stuff
- remove [Link renderer](https://gitlab.com/ix/webize/-/blob/d9927c3251772ff66399fb2927bd4a7c605a5142/Formats/Message.rb#L174), use tabular renderer. made by possible by 'env is optional' changes above since we explicitly don't want request-environment hinted rewrites/relocates when outputting the original upstream links
- usual slew of [CSS tweaks](https://gitlab.com/ix/webize/-/blob/main/config/style/site.css?ref_type=heads) and rule deletions to keep up with fashions and the goal of eliminating all CSS (won't happen till we write a RDF renderer using some wayland UI toolkit. once that's done we can show the video with inlined MPV and streaming text output with $TERM and $PAGER and input boxes with $EDITOR as the creators intended and finally get rid of the chromium/firefox dependency. at no point does JAVASCRIPT enter our picture - not that we particularly dislike it but because it isn't necessary for what we're doing so we'll use stuff we like more, like Ruby+Haskell+sh. the giant $BROWSER binary is the bigger annoyance - we're still on dodgy wifi and go offline and it's as big as the rest of the OS combined in terms of download time, and if including compilation it's ~10x the time and space to build vs everything else for the OS like linux/musl/sway/foot/fuzzel/emacs, if possible. typically we cant even build it on our beefiest 4/8gb devices.. it just gets oomkilled, so any hope of building involves distcc so it fill finish in under a few days plus one device for linking with a huge swapfile on the order of most of the device size (128GB is typically our biggest storage). a binary you can't build sounds a lot like proprietary software. at least if you're sufficiently moneyed you can afford to rent a 192GB-RAM cloud build slice for your personal use so there's that. see devault's [web browsers need to stop](https://drewdevault.com/2020/08/13/Web-browsers-need-to-stop.html) and their [reckless infinite scope](https://drewdevault.com/2020/03/18/Reckless-limitless-scope). "but why would you need to build it".. if a binary existed for the obscure lowend ARM/MIPS/RISC-V stickPC/tablet on a distro using musl libc in an up to date enough version that sites arent throwing version errors, with the ungoogled/librewolf patches to remove some of the plethora of phonehome crap and defaulted-syndicated-content homepages, maybe we wouldn't need to - sometimes we've lucked out on Alpine or AUR and found what we wanted in the package manager.. but it's still no fun waiting an hour for it to DL on the coffeeshop wifi at 47.8k/s with a few timeouts/restarts when we finished drinking the coffee)
- add [#Resource](https://gitlab.com/ix/webize/-/blob/main/Formats/URI.rb?ref_type=heads#L111) and #URI methods for instantiation (aka further work on String#R removal, we're getting closer as most are now where a swap over to RDF::Vocab should work, minimal-performance-regression permitting)
- remove [#cookieCache](https://gitlab.com/ix/webize/-/blob/d9927c3251772ff66399fb2927bd4a7c605a5142/Protocols/HTTP.rb#L150). the last place we needed this was the Twitter and Gitter auth-flows, but Gitter switched to Matrix and Twitter antibotted us too much to even look into, the main site is some kind of infinite redirect loop now even in bare chromium with no extensions so IDK wtf happened there
- switch [RSS selection for reddit](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Protocols/HTTP.rb#L200) from blocklist to allowlist model as they keep adding new paths that no longer provide RSS. the main site is now often broken in this regard, and is treating name.rss as a missing resource etc. misc above changes were due to these last two issues and paving the way to enabling default/automagic forwarding to old.reddit.com and nitter and complete erasure of links to the RSS-sundowning/NonLoggedInUser-hating sites
- remove a [DNS lookup](https://gitlab.com/ix/webize/-/blob/d9927c3251772ff66399fb2927bd4a7c605a5142/Protocols/HTTP.rb#L266) incurred for local vs remote determination. still likely to get these once HTTP libraries are invoked of course, but we don't add our own
- add [timeouts](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Protocols/HTTP.rb#L255) to #fetch to try to make the 'huge feed list with now MIA or temp unavailable servers' scenario return faster. still getting weird as-yet-undiagnosed hangs deep in URI.open/Net::HTTP somewhere. quickest solution (least investigation) is switch the main fetcher over to ioquatix's async-http stuff to make this issue go away. wouldn't it be embarassing if some of thee hangs are due to our DNS server being so naiive? idk if that could be related. it's also slated for ioquatixization but as i started into that a lot of the examples seemed to not work but overall i've experienced nothing but quality from them so that's not a bad sign and who am i to talk, i dont even have unit tests, deployment automation, a written-down code of conduct or a cute logo. so we'll have to read the source, port our DNS stuff over, and see if that helps - it should with ipv6 and reverse lookups anyway, neither of which i've gotten around to implementing at all as they havent seemed super necessary so far. a 75-feed list kind of works with about 10% request failure rate given the current state of affairs but the 500-feed list for boston news is basically completely unusable as you start hitting 120s gateway/proxy/default-server-config timeouts so idk anything about the news unless it hits the scanner on 460 megacycles or staco posts about it on the elon musk site
- remove [ever expanding list of errors](https://gitlab.com/ix/webize/-/blob/d9927c3251772ff66399fb2927bd4a7c605a5142/Protocols/HTTP.rb#L417) to catch on the fetcher - catch 'em all and add a logger for HTML and console output
- add a [new path into multi-fetcher](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Protocols/HTTP.rb#L446) based on existence of local uri-list files
- simplify [#hostGET](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Protocols/HTTP.rb#L505) using changes above like the pure URI-relocation methods and elimination of no-longer-used endpoints
- [normalization](https://gitlab.com/ix/webize/-/blob/13081569080381510456d73fb4983d92b6b7a71a/Protocols/HTTP.rb#L542) of windows-1252 name variants
- usual slew of [blocklist](https://gitlab.com/ix/webize/-/tree/13081569080381510456d73fb4983d92b6b7a71a/config/blocklist) and [metadata-map](https://gitlab.com/ix/webize/-/tree/13081569080381510456d73fb4983d92b6b7a71a/config/metadata) additions and subscription-list maintenance (all but the huge one blocked on non-async-wtf issue)
